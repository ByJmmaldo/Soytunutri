<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NutriMaster V40 - Diagnóstico</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #f1f5f9; font-family: system-ui, sans-serif; }
        .error-box { background: #fee2e2; color: #b91c1c; padding: 20px; border: 2px solid #ef4444; margin: 20px; border-radius: 8px; font-family: monospace; display: none; }
    </style>
</head>
<body>

    <div id="error-display" class="error-box"></div>

    <div x-data="app()" x-init="init()" class="max-w-3xl mx-auto min-h-screen bg-white shadow-2xl flex flex-col">
        
        <div class="bg-slate-900 text-white p-4 sticky top-0 z-50">
            <div class="flex justify-between items-center mb-4">
                <h1 class="text-xl font-bold tracking-tight">NUTRI<span class="text-emerald-400">MASTER</span> <span class="text-xs text-gray-400">V40</span></h1>
                <div class="text-right">
                    <div class="text-2xl font-black" x-text="Math.round(totals.kcal)">0</div>
                    <div class="text-[10px] text-emerald-400 font-bold uppercase">Kcal <span x-text="currentDay"></span></div>
                </div>
            </div>

            <div class="space-y-2">
                <select x-model="selectedPlanIdx" @change="loadPlan()" class="w-full bg-slate-800 text-white text-sm rounded p-2 font-bold border border-slate-700">
                    <template x-for="(plan, index) in plans" :key="index">
                        <option :value="index" x-text="plan.nombre"></option>
                    </template>
                </select>

                <div class="flex gap-1 overflow-x-auto pb-1">
                    <template x-for="day in weekDays" :key="day">
                        <button @click="currentDay = day; loadPlan()" 
                                class="flex-1 py-2 rounded text-[10px] font-bold uppercase transition-colors"
                                :class="currentDay === day ? 'bg-emerald-500 text-white' : 'bg-slate-100 text-slate-500'">
                            <span x-text="day.substring(0,3)"></span>
                        </button>
                    </template>
                </div>
            </div>
        </div>

        <div class="flex-1 p-4 overflow-y-auto pb-20">
            
            <div class="grid grid-cols-3 gap-2 mb-6 text-center">
                <div class="bg-blue-50 p-2 rounded border border-blue-100">
                    <div class="text-blue-600 font-black text-lg" x-text="Math.round(totals.p)">0</div>
                    <div class="text-[9px] text-blue-400 font-bold uppercase">Proteína</div>
                </div>
                <div class="bg-amber-50 p-2 rounded border border-amber-100">
                    <div class="text-amber-600 font-black text-lg" x-text="Math.round(totals.f)">0</div>
                    <div class="text-[9px] text-amber-400 font-bold uppercase">Grasa</div>
                </div>
                <div class="bg-rose-50 p-2 rounded border border-rose-100">
                    <div class="text-rose-600 font-black text-lg" x-text="Math.round(totals.c)">0</div>
                    <div class="text-[9px] text-rose-400 font-bold uppercase">Carbs</div>
                </div>
            </div>

            <template x-for="meal in mealOrder" :key="meal">
                <div class="mb-4 bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden" 
                     x-show="dayData[meal] && dayData[meal].length > 0">
                    
                    <div class="px-4 py-2 bg-slate-50 border-b border-slate-100 flex justify-between items-center">
                        <h3 class="font-bold text-xs text-slate-700 uppercase" x-text="meal"></h3>
                        <span class="text-[9px] font-bold bg-white px-2 py-0.5 rounded border border-slate-200 text-slate-500" 
                              x-text="getMealKcal(dayData[meal]) + ' kcal'"></span>
                    </div>

                    <ul class="divide-y divide-slate-50">
                        <template x-for="ing in dayData[meal]" :key="ing.n">
                            <li class="px-4 py-2 flex justify-between items-center hover:bg-slate-50">
                                <div>
                                    <div class="font-bold text-sm text-slate-800" x-text="ing.n"></div>
                                    <div class="text-[10px] text-slate-400" x-show="db[ing.k]">
                                        <span x-text="'P:'+Math.round(calc(ing.k, ing.q).p)"></span>
                                        <span x-text="' F:'+Math.round(calc(ing.k, ing.q).f)"></span>
                                        <span x-text="' C:'+Math.round(calc(ing.k, ing.q).c)"></span>
                                    </div>
                                    <div x-show="!db[ing.k]" class="text-[10px] text-red-500 font-bold">⚠️ No encontrado en DB</div>
                                </div>
                                <div class="text-right">
                                    <div class="font-black text-sm text-slate-900" x-text="ing.q"></div>
                                    <div class="text-[9px] font-bold text-slate-400 uppercase" x-text="getUnit(ing.k)"></div>
                                </div>
                            </li>
                        </template>
                    </ul>
                </div>
            </template>
            
            <div x-show="!dayData || Object.keys(dayData).length === 0" class="text-center py-10 text-slate-400 text-sm">
                Cargando datos...
            </div>
        </div>
    </div>

    <script>
        // --- 1. BASE DE DATOS DE ALIMENTOS ---
        const DB = {
            'pan': {k:260,p:8,f:2,c:50}, 'pan_integral': {k:250,p:9,f:3,c:45}, 'pan_molde': {k:260,p:8,f:3,c:48},
            'huevo': {k:143,p:12.5,f:9.5,c:0.7}, 'claras': {k:52,p:11,f:0.2,c:0.7}, 'tortilla': {k:150,p:11,f:10,c:1},
            'pollo': {k:110,p:23,f:1.2,c:0}, 'ternera': {k:130,p:21,f:4,c:0}, 'pavo': {k:105,p:22,f:2,c:0},
            'lomo': {k:145,p:21,f:6,c:0}, 'lomo_embuchado': {k:190,p:38,f:6,c:0}, 'jamon_cocido': {k:105,p:18,f:3,c:1},
            'jamon_serrano': {k:240,p:30,f:12,c:0}, 'hamburguesa': {k:220,p:17,f:15,c:1}, 'burger_pollo_90': {k:140,p:20,f:6,c:2},
            'hamburguesa_ternera': {k:220,p:17,f:15,c:1}, 'bacon': {k:500,p:14,f:50,c:1}, 
            'merluza': {k:80,p:17,f:1,c:0}, 'atun_lata': {k:100,p:24,f:1,c:0}, 'salmon': {k:208,p:20,f:13,c:0},
            'bacalao': {k:82,p:18,f:0.7,c:0}, 'sepia': {k:80,p:16,f:1,c:1}, 'langostinos': {k:95,p:20,f:1.5,c:0},
            'gambas': {k:95,p:20,f:1.5,c:0}, 'gambitas': {k:95,p:20,f:1.5,c:0}, 'surimi': {k:95,p:8,f:2,c:10}, 'anchoas': {k:210,p:29,f:10,c:0},
            'arroz': {k:360,p:7,f:1,c:78}, 'pasta': {k:350,p:12,f:1.5,c:72}, 'patata': {k:77,p:2,f:0.1,c:17},
            'boniato': {k:86,p:1.6,f:0.1,c:20}, 'avena': {k:370,p:13,f:7,c:60}, 'cuscus': {k:112,p:3.8,f:0.2,c:23},
            'garbanzos': {k:120,p:7,f:2,c:20}, 'lentejas': {k:115,p:9,f:0.5,c:20}, 'guisantes': {k:81,p:5,f:0.5,c:14}, 'habitas': {k:80,p:6,f:0.5,c:12},
            'leche': {k:45,p:3,f:1.5,c:5}, 'leche_entera': {k:62,p:3,f:3.5,c:5}, 'yogur': {k:60,p:4.5,f:3,c:4},
            'queso_fresco': {k:70,p:11,f:2,c:3}, 'queso_batido': {k:46,p:8,f:0.1,c:3.5}, 'queso_fundir': {k:300,p:20,f:22,c:1},
            'aguacate': {k:160,p:2,f:15,c:9}, 'aceite': {k:884,p:0,f:100,c:0}, 'nueces': {k:654,p:15,f:65,c:14},
            'almendras': {k:579,p:21,f:50,c:22}, 'anacardos': {k:553,p:18,f:44,c:30}, 'crema_cacahuete': {k:590,p:25,f:49,c:16},
            'tomate': {k:18,p:1,f:0.2,c:4}, 'verdura': {k:30,p:2,f:0.2,c:5}, 'espinacas': {k:23,p:3,f:0.4,c:3.6},
            'calabacin': {k:17,p:1,f:0.3,c:3}, 'champinones': {k:22,p:3,f:0.3,c:3}, 'pisto': {k:80,p:2,f:5,c:8},
            'fruta': {k:50,p:0.5,f:0.2,c:12}, 'platano': {k:89,p:1,f:0.3,c:23}, 'manzana': {k:52,p:0.3,f:0.2,c:14},
            'fresas': {k:32,p:0.7,f:0.3,c:8}, 'piña': {k:50,p:0.5,f:0.1,c:13}, 'kiwi': {k:61,p:1,f:0.5,c:15},
            'tortitas': {k:380,p:8,f:3,c:80}, 'tortita_trigo': {k:300,p:8,f:5,c:50}, 'biscotes': {k:390,p:10,f:6,c:72},
            'cafe': {k:2,p:0,f:0,c:0}, 'cacao': {k:300,p:20,f:10,c:15}, 'mermelada': {k:250,p:0,f:0,c:60},
            'avellanas': {k:628,p:15,f:60,c:17}, 'cebolla': {k:40,p:1,f:0.1,c:9}, 'canonigos': {k:21,p:2,f:0.4,c:3}
        };
        const WEIGHTS = { 'huevo': 60, 'tortilla': 1, 'yogur': 125, 'tortitas': 8, 'platano': 100, 'fruta': 150, 'manzana': 180, 'kiwi': 80, 'pan': 1, 'galletas': 6 };

        // 2. PLANES (Aquí añadiremos el resto poco a poco)
        const PLANS = [
            // PLAN 25: 8 JUNIO (Volumen Alto) - VERIFICADO AL 100%
            {
                nombre: "8 Junio 2025 (Volumen Alto)",
                dias: {
                    "Lunes": {
                        "Desayuno": [{k:"pan",n:"Pan",q:120},{k:"huevo",n:"Huevo",q:1},{k:"aguacate",n:"Aguacate",q:60},{k:"cafe",n:"Café",q:1}],
                        "Media Mañana": [{k:"fruta",n:"Pieza Fruta",q:1}],
                        "Comida": [{k:"garbanzos",n:"Garbanzos",q:300},{k:"pollo",n:"Pollo",q:200},{k:"pisto",n:"Pisto",q:150}],
                        "Merienda": [{k:"pan",n:"Pan",q:80},{k:"lomo_embuchado",n:"Lomo",q:25},{k:"nueces",n:"Nueces",q:15}],
                        "Cena": [{k:"claras",n:"Revuelto Claras",q:100},{k:"huevo",n:"Huevo",q:2},{k:"yogur",n:"Yogur Griego",q:125},{k:"pan",n:"Pan",q:100}]
                    },
                    "Martes": {
                        "Desayuno": [{k:"pan",n:"Pan",q:80},{k:"fruta",n:"Pieza Fruta",q:1},{k:"lomo_embuchado",n:"Lomo",q:25},{k:"aguacate",n:"Aguacate",q:60},{k:"cafe",n:"Café",q:1}],
                        "Media Mañana": [{k:"pan",n:"Pan",q:1}], 
                        "Comida": [{k:"pasta",n:"Pasta",q:70},{k:"ternera",n:"Ternera",q:200},{k:"queso_fundir",n:"Queso",q:45}],
                        "Merienda": [{k:"tortitas",n:"Tortitas Maíz",q:4},{k:"pavo",n:"Pavo",q:50},{k:"nueces",n:"Nueces",q:15}],
                        "Cena": [{k:"calabacin",n:"Calabacín/Cebolla",q:150},{k:"atun_lata",n:"Atún",q:120},{k:"yogur",n:"Yogur Proteico",q:125},{k:"pan",n:"Pan",q:100}]
                    },
                    "Miércoles": { 
                        "Desayuno":[{k:"pan",n:"Pan",q:120},{k:"huevo",n:"Huevo",q:1},{k:"aguacate",n:"Aguacate",q:60}], 
                        "Media Mañana":[{k:"fruta",n:"Pieza Fruta",q:1}], 
                        "Comida":[{k:"lentejas",n:"Lentejas",q:300},{k:"atun_lata",n:"Atún",q:120},{k:"huevo",n:"Huevo",q:2},{k:"aguacate",n:"Aguacate",q:90}], 
                        "Merienda":[{k:"platano",n:"Plátano",q:1},{k:"queso_batido",n:"Queso Batido",q:90},{k:"crema_cacahuete",n:"Crema CC",q:15}], 
                        "Cena":[{k:"pollo",n:"Pollo Soja",q:150},{k:"champinones",n:"Champiñones",q:50},{k:"pan",n:"Pan",q:100}] 
                    },
                    "Jueves": { 
                        "Desayuno":[{k:"pan",n:"Pan",q:80},{k:"fruta",n:"Fruta",q:1},{k:"pavo",n:"Pavo",q:50},{k:"aceite",n:"Aceite",q:10}], 
                        "Media Mañana":[{k:"fruta",n:"Fruta",q:1}], 
                        "Comida":[{k:"arroz",n:"Arroz",q:70},{k:"salmon",n:"Salmón",q:160}], 
                        "Merienda":[{k:"platano",n:"Plátano",q:1},{k:"queso_batido",n:"Queso Batido",q:90},{k:"crema_cacahuete",n:"Crema CC",q:15}], 
                        "Cena":[{k:"ternera",n:"Fajita Ternera",q:90},{k:"tortita_trigo",n:"Tortitas",q:2},{k:"verdura",n:"Verduras",q:100},{k:"yogur",n:"Yogur Griego",q:125},{k:"pan",n:"Pan",q:100}] 
                    },
                    "Viernes": { 
                        "Desayuno":[{k:"pan",n:"Pan",q:40},{k:"pavo",n:"Pavo",q:50},{k:"aceite",n:"Aceite",q:10}], 
                        "Media Mañana":[{k:"fruta",n:"Fruta",q:1}], 
                        "Comida":[{k:"verdura",n:"Revuelto Verduras",q:150},{k:"lomo",n:"Solomillo",q:160}], 
                        "Merienda":[{k:"tortitas",n:"Tortitas",q:4},{k:"pavo",n:"Pavo",q:50},{k:"nueces",n:"Nueces",q:15}], 
                        "Cena":[{k:"verdura",n:"Ensalada",q:100},{k:"huevo",n:"Huevo",q:1},{k:"atun_lata",n:"Atún",q:60},{k:"aceitunas",n:"Aceitunas",q:15},{k:"pan",n:"Pan",q:100}] 
                    },
                    "Sábado": { 
                        "Desayuno":[{k:"pan",n:"Pan",q:120},{k:"huevo",n:"Huevo",q:1},{k:"aguacate",n:"Aguacate",q:60}], 
                        "Media Mañana":[{k:"fruta",n:"Fruta",q:1}], 
                        "Comida":[{k:"pisto",n:"Pisto",q:100},{k:"cuscus",n:"Cuscús",q:75},{k:"pollo",n:"Pollo",q:200}], 
                        "Merienda":[{k:"pan",n:"Pan",q:80},{k:"lomo_embuchado",n:"Lomo",q:25},{k:"nueces",n:"Nueces",q:15}], 
                        "Cena":[{k:"huevo",n:"Tortilla",q:1},{k:"claras",n:"Claras",q:100},{k:"espinacas",n:"Espinacas",q:50},{k:"pan",n:"Pan",q:100}] 
                    },
                    "Domingo": { 
                        "Desayuno":[{k:"pan",n:"Pan",q:80},{k:"aceite",n:"Aceite",q:10},{k:"lomo_embuchado",n:"Lomo",q:25}], 
                        "Media Mañana":[{k:"fruta",n:"Fruta",q:1}], 
                        "Comida":[{k:"arroz",n:"Arroz",q:70},{k:"burger_pollo_90",n:"Hamburguesa",q:200}], 
                        "Merienda":[{k:"tortitas",n:"Tortitas",q:4},{k:"pavo",n:"Pavo",q:50},{k:"nueces",n:"Nueces",q:15}], 
                        "Cena":[{k:"salmon",n:"Salmón",q:120},{k:"pisto",n:"Pisto",q:100},{k:"pan",n:"Pan",q:100}] 
                    }
                }
            },
            // PLAN 24: 9-22 JUNIO
            {
                nombre: "9-22 Junio 2025",
                dias: {
                    "Lunes": { 
                        "Desayuno":[{k:"leche",n:"Leche",q:225},{k:"pan",n:"Pan",q:70},{k:"jamon_cocido",n:"Jamón",q:30},{k:"platano",n:"Plátano",q:1},{k:"almendras",n:"Almendras",q:15}],
                        "Media Mañana":[{k:"pan_molde",n:"Tostada Integral",q:90},{k:"jamon_serrano",n:"Jamón",q:45}],
                        "Comida":[{k:"lentejas",n:"Lentejas Setas",q:175},{k:"champinones",n:"Setas",q:50},{k:"pollo",n:"Pollo",q:150},{k:"tomate",n:"Tomate",q:50},{k:"fresas",n:"Fresas",q:150}],
                        "Merienda":[{k:"fresas",n:"Fresas",q:150},{k:"yogur",n:"Yogur",q:125}],
                        "Cena":[{k:"huevo",n:"Tortilla",q:1},{k:"claras",n:"Claras",q:70},{k:"espinacas",n:"Espinacas",q:70},{k:"queso_fresco",n:"Queso",q:60},{k:"manzana",n:"Manzana",q:1}]
                    },
                    "Martes": { 
                        "Desayuno":[{k:"leche",n:"Leche Calcio",q:150},{k:"pan_integral",n:"Pan",q:40},{k:"tomate",n:"Tomate",q:30},{k:"jamon_serrano",n:"Jamón",q:15},{k:"platano",n:"Plátano",q:1},{k:"almendras",n:"Almendras",q:15}],
                        "Media Mañana":[{k:"queso_batido",n:"Queso Batido",q:120},{k:"avellanas",n:"Avellanas",q:15},{k:"fresas",n:"Fresas",q:120}],
                        "Comida":[{k:"pasta",n:"Espaguetis",q:40},{k:"salmon",n:"Salmón",q:170},{k:"canonigos",n:"Canónigos",q:50},{k:"manzana",n:"Manzana",q:1}],
                        "Merienda":[{k:"fresas",n:"Fresas",q:150},{k:"yogur",n:"Yogur",q:125}],
                        "Cena":[{k:"burger_pollo_90",n:"Hamburguesa",q:130},{k:"pisto",n:"Pisto",q:100},{k:"platano",n:"Plátano",q:1}]
                    },
                    "Miércoles": { "Desayuno":[{k:"leche",n:"Leche",q:225},{k:"pan",n:"Pan",q:70},{k:"aguacate",n:"Aguacate",q:50}], "Media Mañana":[{k:"pan_molde",n:"Tostada",q:90},{k:"aguacate",n:"Aguacate",q:75}], "Comida":[{k:"lentejas",n:"Lentejas",q:80},{k:"pavo",n:"Pavo",q:200}], "Merienda":[{k:"yogur",n:"Yogur",q:125}], "Cena":[{k:"atun_lata",n:"Atun",q:100}] },
                    "Jueves": { "Desayuno":[{k:"leche",n:"Leche",q:225},{k:"pan",n:"Pan",q:70}], "Media Mañana":[{k:"yogur",n:"Yogur",q:125},{k:"platano",n:"Platano",q:1}], "Comida":[{k:"pasta",n:"Pasta",q:40},{k:"hamburguesa_ternera",n:"Hamburguesa",q:130}], "Merienda":[{k:"yogur",n:"Yogur",q:125}], "Cena":[{k:"huevo",n:"Tortilla",q:1},{k:"claras",n:"Claras",q:35}] },
                    "Viernes": { "Desayuno":[{k:"leche",n:"Leche",q:225},{k:"pan",n:"Pan",q:70}], "Media Mañana":[{k:"pan_molde",n:"Tostada",q:90}], "Comida":[{k:"arroz",n:"Arroz",q:70},{k:"salmon",n:"Salmon",q:75}], "Merienda":[{k:"yogur",n:"Yogur",q:125}], "Cena":[{k:"pollo",n:"Pollo",q:100}] },
                    "Sábado": { "Desayuno":[{k:"leche",n:"Leche",q:225},{k:"pan",n:"Pan",q:100}], "Media Mañana":[{k:"yogur",n:"Yogur",q:250},{k:"nueces",n:"Nueces",q:10}], "Comida":[{k:"guisantes",n:"Guisantes",q:150},{k:"gambas",n:"Gambas",q:100},{k:"ternera",n:"Ternera",q:150}], "Merienda":[{k:"yogur",n:"Yogur",q:125}], "Cena":[{k:"pavo",n:"Pavo",q:125}] },
                    "Domingo": { "Desayuno":[{k:"leche",n:"Leche",q:225},{k:"pan",n:"Pan",q:70}], "Media Mañana":[{k:"pan_molde",n:"Tostada",q:90}], "Comida":[{k:"pasta",n:"Pasta",q:40},{k:"atun_lata",n:"Atun",q:100}], "Merienda":[{k:"yogur",n:"Yogur",q:125}], "Cena":[{k:"salmon",n:"Salmon",q:120}] }
                }
            }
        ];

        function app() {
            return {
                db: DB,
                plans: PLANS,
                weights: WEIGHTS,
                selectedPlanIdx: 0,
                currentDay: 'Lunes',
                weekDays: ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado', 'Domingo'],
                mealOrder: ['Desayuno', 'Media Mañana', 'Comida', 'Merienda', 'Cena'],
                dayData: {},
                totals: { p:0, f:0, c:0, kcal:0 },

                init() {
                    try {
                        this.loadPlan();
                    } catch(e) {
                        document.getElementById('error-display').style.display = 'block';
                        document.getElementById('error-display').innerText = "ERROR CRÍTICO: " + e.message;
                    }
                },

                loadPlan() {
                    if (!this.plans || !this.plans[this.selectedPlanIdx]) return;
                    const plan = this.plans[this.selectedPlanIdx];
                    let rawData = plan.dias[this.currentDay];
                    
                    if (!rawData) {
                        this.dayData = {}; // Evitar crash si no hay datos
                    } else {
                        // Deep copy
                        this.dayData = JSON.parse(JSON.stringify(rawData));
                    }
                    this.calcTotals();
                },

                setDay(day) {
                    this.currentDay = day;
                    this.loadPlan();
                },

                getMacros(k, q) {
                    const i = this.db[k];
                    if (!i) return { p:0, f:0, c:0, k:0 };
                    let grams = q;
                    if(this.weights[k] && q < 10) grams = q * this.weights[k];
                    return {
                        p: (i.p*grams)/100, f: (i.f*grams)/100, c: (i.c*grams)/100, k: (i.k*grams)/100
                    };
                },

                calc(k, q) { return this.getMacros(k, q); }, // Alias

                getMealKcal(ingredients) {
                    if(!ingredients) return 0;
                    return Math.round(ingredients.reduce((a,c) => a + this.getMacros(c.k, c.q).k, 0));
                },

                calcTotals() {
                    this.totals = { p:0, f:0, c:0, kcal:0 };
                    this.mealOrder.forEach(meal => {
                        if (this.dayData[meal]) {
                            this.dayData[meal].forEach(i => {
                                const m = this.getMacros(i.k, i.q);
                                this.totals.p += m.p; this.totals.f += m.f; this.totals.c += m.c; this.totals.kcal += m.k;
                            });
                        }
                    });
                },

                getUnit(k) {
                    if(['leche','cafe'].includes(k)) return 'ml';
                    if(this.weights[k]) return 'ud';
                    return 'g';
                },

                getMealColor(name) {
                    const n = name.toLowerCase();
                    if(n.includes('desayuno')) return 'bg-amber-400 text-white';
                    if(n.includes('media')) return 'bg-orange-300 text-white';
                    if(n.includes('comida')) return 'bg-emerald-500 text-white';
                    if(n.includes('merienda')) return 'bg-purple-400 text-white';
                    if(n.includes('cena')) return 'bg-indigo-500 text-white';
                    return 'bg-gray-200 text-slate-600';
                }
            }
        }
    </script>
</body>
</html>
