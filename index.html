<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NutriMaster - Paso a Paso</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        [x-cloak] { display: none !important; }
        body { font-family: system-ui, sans-serif; background-color: #f8fafc; color: #1e293b; }
        .meal-card { background: white; border-radius: 12px; border: 1px solid #e2e8f0; margin-bottom: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .day-btn { @apply flex-1 py-2 px-1 rounded-lg text-[10px] font-bold uppercase tracking-wider border border-slate-200 bg-white text-slate-500 transition-all; }
        .day-btn.active { @apply bg-emerald-500 text-white border-emerald-500 shadow-md transform scale-105; }
    </style>
</head>
<body class="antialiased">

<div x-data="nutritionApp()" x-init="initApp()" class="max-w-md mx-auto min-h-screen bg-white shadow-2xl flex flex-col border-x border-slate-100">

    <div class="bg-slate-900 text-white p-4 sticky top-0 z-50 shadow-lg">
        <div class="flex justify-between items-end mb-4">
            <div>
                <h1 class="text-xl font-black tracking-tighter italic">NUTRI<span class="text-emerald-400">MASTER</span></h1>
                <p class="text-[10px] text-slate-400 font-medium">Versión Paso a Paso</p>
            </div>
            <div class="text-right">
                <div class="text-3xl font-black leading-none" x-text="Math.round(totals.kcal)">0</div>
                <div class="text-[9px] font-bold text-emerald-400 uppercase tracking-widest">Kcal <span x-text="currentDay"></span></div>
            </div>
        </div>

        <div class="space-y-2">
            <select x-model="selectedPlanIdx" class="w-full bg-slate-800 border border-slate-700 text-white text-xs rounded-lg py-3 px-3 font-bold focus:ring-1 focus:ring-emerald-500 outline-none">
                <template x-for="(plan, index) in plans" :key="index">
                    <option :value="index" x-text="plan.nombre"></option>
                </template>
            </select>

            <div class="flex gap-1 overflow-x-auto pb-1 scrollbar-hide">
                <template x-for="day in weekDays" :key="day">
                    <button @click="currentDay = day" class="day-btn" :class="{'active': currentDay === day}">
                        <span x-text="day.substring(0,3)"></span>
                    </button>
                </template>
            </div>
        </div>
    </div>

    <div class="flex-1 p-4 overflow-y-auto bg-slate-50">
        
        <div class="grid grid-cols-3 gap-2 mb-6">
            <div class="bg-white p-2 rounded-xl border border-slate-100 text-center shadow-sm">
                <div class="text-blue-600 font-black text-lg" x-text="Math.round(totals.p)">0</div>
                <div class="text-[9px] text-slate-400 font-bold uppercase">Prot (g)</div>
            </div>
            <div class="bg-white p-2 rounded-xl border border-slate-100 text-center shadow-sm">
                <div class="text-amber-500 font-black text-lg" x-text="Math.round(totals.f)">0</div>
                <div class="text-[9px] text-slate-400 font-bold uppercase">Grasa (g)</div>
            </div>
            <div class="bg-white p-2 rounded-xl border border-slate-100 text-center shadow-sm">
                <div class="text-rose-500 font-black text-lg" x-text="Math.round(totals.c)">0</div>
                <div class="text-[9px] text-slate-400 font-bold uppercase">Carbs (g)</div>
            </div>
        </div>

        <div class="space-y-3 pb-20">
            <template x-for="mealName in mealOrder" :key="mealName">
                <div class="meal-card" x-show="dayData[mealName] && dayData[mealName].length > 0">
                    <div class="px-4 py-2 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                        <h3 class="font-black text-slate-700 text-[10px] uppercase tracking-widest flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full" :class="getMealColor(mealName)"></span>
                            <span x-text="mealName"></span>
                        </h3>
                        <span class="text-[9px] font-bold text-slate-500 bg-white px-2 py-0.5 rounded border border-slate-200" x-text="getMealKcal(dayData[mealName]) + ' kcal'"></span>
                    </div>
                    <ul class="divide-y divide-slate-50">
                        <template x-for="ing in dayData[mealName]" :key="ing.n">
                            <li class="px-4 py-2.5 flex justify-between items-center">
                                <div>
                                    <div class="font-bold text-slate-800 text-xs" x-text="ing.n"></div>
                                    <div class="flex gap-2 text-[9px] font-semibold text-slate-400" x-show="db[ing.k]">
                                        <span class="text-blue-400">P:<span x-text="Math.round(calc(ing.k, ing.q).p)"></span></span>
                                        <span class="text-rose-400">C:<span x-text="Math.round(calc(ing.k, ing.q).c)"></span></span>
                                        <span class="text-amber-400">G:<span x-text="Math.round(calc(ing.k, ing.q).f)"></span></span>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="font-black text-slate-800 text-sm" x-text="ing.q"></div>
                                    <div class="text-[8px] uppercase text-slate-400 font-bold" x-text="getUnit(ing.k)"></div>
                                </div>
                            </li>
                        </template>
                    </ul>
                </div>
            </template>
            
            <div x-show="!hasData" class="text-center py-10 text-slate-400 text-xs italic">
                Cargando datos...
            </div>
        </div>
    </div>
</div>

<script>
    function nutritionApp() {
        return {
            selectedPlanIdx: 0,
            currentDay: 'Lunes',
            weekDays: ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado', 'Domingo'],
            mealOrder: ['Desayuno', 'Media Mañana', 'Comida', 'Merienda', 'Cena'],
            
            // 1. BASE DE DATOS
            db: {
                'pan': {k:260, p:8, f:2, c:50}, 'pan_integral': {k:250, p:9, f:3, c:45}, 'pan_molde': {k:260, p:8, f:3, c:48},
                'huevo': {k:143, p:12.5, f:9.5, c:0.7}, 'claras': {k:52, p:11, f:0.2, c:0.7}, 'tortilla': {k:150, p:11, f:10, c:1},
                'pollo': {k:110, p:23, f:1.2, c:0}, 'ternera': {k:130, p:21, f:4, c:0}, 'pavo': {k:105, p:22, f:2, c:0},
                'lomo': {k:145, p:21, f:6, c:0}, 'lomo_embuchado': {k:190, p:38, f:6, c:0},
                'jamon_cocido': {k:105, p:18, f:3, c:1}, 'jamon_serrano': {k:240, p:30, f:12, c:0},
                'atun_lata': {k:100, p:24, f:1, c:0}, 'salmon': {k:208, p:20, f:13, c:0}, 'bacalao': {k:82, p:18, f:0.7, c:0},
                'merluza': {k:80, p:17, f:1, c:0}, 'surimi': {k:95, p:8, f:2, c:10}, 'gambas': {k:95, p:20, f:1.5, c:0},
                'arroz': {k:360, p:7, f:1, c:78}, 'pasta': {k:350, p:12, f:1.5, c:72}, 'patata': {k:77, p:2, f:0.1, c:17},
                'boniato': {k:86, p:1.6, f:0.1, c:20}, 'avena': {k:370, p:13, f:7, c:60}, 'cuscus': {k:112, p:3.8, f:0.2, c:23},
                'garbanzos': {k:120, p:7, f:2, c:20}, 'lentejas': {k:115, p:9, f:0.5, c:20}, 'guisantes': {k:81, p:5, f:0.5, c:14},
                'leche': {k:45, p:3, f:1.5, c:5}, 'leche_entera': {k:62, p:3, f:3.5, c:5}, 'yogur': {k:60, p:4.5, f:3, c:4},
                'queso_fresco': {k:70, p:11, f:2, c:3}, 'queso_batido': {k:46, p:8, f:0.1, c:3.5}, 'queso_fundir': {k:300, p:20, f:22, c:1},
                'aguacate': {k:160, p:2, f:15, c:9}, 'aceite': {k:884, p:0, f:100, c:0}, 'nueces': {k:654, p:15, f:65, c:14},
                'almendras': {k:579, p:21, f:50, c:22}, 'anacardos': {k:553, p:18, f:44, c:30}, 'crema_cacahuete': {k:590, p:25, f:49, c:16},
                'tomate': {k:18, p:1, f:0.2, c:4}, 'verdura': {k:30, p:2, f:0.2, c:5}, 'espinacas': {k:23, p:3, f:0.4, c:3.6},
                'calabacin': {k:17, p:1, f:0.3, c:3}, 'champinones': {k:22, p:3, f:0.3, c:3}, 'pisto': {k:80, p:2, f:5, c:8},
                'fruta': {k:50, p:0.5, f:0.2, c:12}, 'platano': {k:89, p:1, f:0.3, c:23}, 'manzana': {k:52, p:0.3, f:0.2, c:14},
                'fresas': {k:32, p:0.7, f:0.3, c:8}, 'piña': {k:50, p:0.5, f:0.1, c:13}, 'kiwi': {k:61, p:1, f:0.5, c:15},
                'tortitas': {k:380, p:8, f:3, c:80}, 'tortita_trigo': {k:300, p:8, f:5, c:50}, 'biscotes': {k:390, p:10, f:6, c:72},
                'cafe': {k:2, p:0, f:0, c:0}, 'cacao': {k:300, p:20, f:10, c:15}, 'mermelada': {k:250, p:0, f:0, c:60}
            },
            weights: { 'huevo': 60, 'tortilla': 1, 'yogur': 125, 'tortitas': 8, 'platano': 100, 'fruta': 150, 'manzana': 180, 'kiwi': 80, 'pan': 1, 'galletas': 6 },

            // 2. PLANES (Aquí iremos añadiendo uno a uno)
            plans: [
                // PLAN 25: 8 JUNIO (Volumen Alto)
                {
                    nombre: "8 Junio 2025 (Volumen Alto)",
                    dias: {
                        "Lunes": {
                            "Desayuno": [{k:"pan",n:"Pan",q:120},{k:"huevo",n:"Huevo",q:1},{k:"aguacate",n:"Aguacate",q:60},{k:"cafe",n:"Café",q:1}],
                            "Media Mañana": [{k:"fruta",n:"Pieza Fruta",q:1}],
                            "Comida": [{k:"garbanzos",n:"Garbanzos",q:300},{k:"pollo",n:"Pollo",q:200},{k:"pisto",n:"Pisto",q:150}],
                            "Merienda": [{k:"pan",n:"Pan",q:80},{k:"lomo_embuchado",n:"Lomo",q:25},{k:"nueces",n:"Nueces",q:15}],
                            "Cena": [{k:"claras",n:"Revuelto Claras",q:100},{k:"huevo",n:"Huevo",q:2},{k:"yogur",n:"Yogur Griego",q:125},{k:"pan",n:"Pan",q:100}]
                        },
                        "Martes": {
                            "Desayuno": [{k:"pan",n:"Pan",q:80},{k:"fruta",n:"Pieza Fruta",q:1},{k:"lomo_embuchado",n:"Lomo",q:25},{k:"aguacate",n:"Aguacate",q:60},{k:"cafe",n:"Café",q:1}],
                            "Media Mañana": [{k:"pan",n:"Pan",q:1}],
                            "Comida": [{k:"pasta",n:"Pasta",q:70},{k:"ternera",n:"Ternera",q:200},{k:"queso_fundir",n:"Queso",q:45}],
                            "Merienda": [{k:"tortitas",n:"Tortitas Maíz",q:4},{k:"pavo",n:"Pavo",q:50},{k:"nueces",n:"Nueces",q:15}],
                            "Cena": [{k:"calabacin",n:"Calabacín/Cebolla",q:150},{k:"atun_lata",n:"Atún",q:120},{k:"yogur",n:"Yogur Proteico",q:125},{k:"pan",n:"Pan",q:100}]
                        },
                        "Miércoles": { "Desayuno":[{k:"pan",n:"Pan",q:120},{k:"huevo",n:"Huevo",q:1},{k:"aguacate",n:"Aguacate",q:60}], "Media Mañana":[{k:"fruta",n:"Pieza Fruta",q:1}], "Comida":[{k:"lentejas",n:"Lentejas",q:300},{k:"atun_lata",n:"Atún",q:120},{k:"huevo",n:"Huevo",q:2},{k:"aguacate",n:"Aguacate",q:90}], "Merienda":[{k:"platano",n:"Plátano",q:1},{k:"queso_batido",n:"Queso Batido",q:90},{k:"crema_cacahuete",n:"Crema CC",q:15}], "Cena":[{k:"pollo",n:"Pollo Soja",q:150},{k:"champinones",n:"Champiñones",q:50},{k:"pan",n:"Pan",q:100}] },
                        "Jueves": { "Desayuno":[{k:"pan",n:"Pan",q:80},{k:"fruta",n:"Fruta",q:1},{k:"pavo",n:"Pavo",q:50},{k:"aceite",n:"Aceite",q:10}], "Media Mañana":[{k:"fruta",n:"Fruta",q:1}], "Comida":[{k:"arroz",n:"Arroz",q:70},{k:"salmon",n:"Salmón",q:160}], "Merienda":[{k:"platano",n:"Plátano",q:1},{k:"queso_batido",n:"Queso Batido",q:90},{k:"crema_cacahuete",n:"Crema CC",q:15}], "Cena":[{k:"ternera",n:"Fajita Ternera",q:90},{k:"tortita_trigo",n:"Tortitas",q:2},{k:"verdura",n:"Verduras",q:100},{k:"yogur",n:"Yogur Griego",q:125},{k:"pan",n:"Pan",q:100}] },
                        "Viernes": { "Desayuno":[{k:"pan",n:"Pan",q:40},{k:"pavo",n:"Pavo",q:50},{k:"aceite",n:"Aceite",q:10}], "Media Mañana":[{k:"fruta",n:"Fruta",q:1}], "Comida":[{k:"verdura",n:"Revuelto Verduras",q:150},{k:"lomo",n:"Solomillo",q:160}], "Merienda":[{k:"tortitas",n:"Tortitas",q:4},{k:"pavo",n:"Pavo",q:50},{k:"nueces",n:"Nueces",q:15}], "Cena":[{k:"verdura",n:"Ensalada",q:100},{k:"huevo",n:"Huevo",q:1},{k:"atun_lata",n:"Atún",q:60},{k:"aceitunas",n:"Aceitunas",q:15},{k:"pan",n:"Pan",q:100}] },
                        "Sábado": { "Desayuno":[{k:"pan",n:"Pan",q:120},{k:"huevo",n:"Huevo",q:1},{k:"aguacate",n:"Aguacate",q:60}], "Media Mañana":[{k:"fruta",n:"Fruta",q:1}], "Comida":[{k:"pisto",n:"Pisto",q:100},{k:"cuscus",n:"Cuscús",q:75},{k:"pollo",n:"Pollo",q:200}], "Merienda":[{k:"pan",n:"Pan",q:80},{k:"lomo_embuchado",n:"Lomo",q:25},{k:"nueces",n:"Nueces",q:15}], "Cena":[{k:"huevo",n:"Tortilla",q:1},{k:"claras",n:"Claras",q:100},{k:"espinacas",n:"Espinacas",q:50},{k:"pan",n:"Pan",q:100}] },
                        "Domingo": { "Desayuno":[{k:"pan",n:"Pan",q:80},{k:"aceite",n:"Aceite",q:10},{k:"lomo_embuchado",n:"Lomo",q:25}], "Media Mañana":[{k:"fruta",n:"Fruta",q:1}], "Comida":[{k:"arroz",n:"Arroz",q:70},{k:"burger_pollo_90",n:"Hamburguesa",q:200}], "Merienda":[{k:"tortitas",n:"Tortitas",q:4},{k:"pavo",n:"Pavo",q:50},{k:"nueces",n:"Nueces",q:15}], "Cena":[{k:"salmon",n:"Salmón",q:120},{k:"pisto",n:"Pisto",q:100},{k:"pan",n:"Pan",q:100}] }
                    }
                }
            ],
            
            dayData: null,
            hasData: false,
            totals: { p:0, f:0, c:0, kcal:0 },

            initApp() {
                // Escucha cambios para recargar
                this.$watch('selectedPlanIdx', () => this.loadPlan());
                this.$watch('currentDay', () => this.loadPlan());
                
                // Carga inicial
                this.loadPlan();
            },

            loadPlan() {
                const plan = this.plans[this.selectedPlanIdx];
                if (!plan) return;

                let rawData = plan.dias[this.currentDay];
                if (!rawData) {
                    // Fallback si el día no existe (ej: planes antiguos de 5 días)
                    rawData = plan.dias['Lunes']; 
                }
                
                // Deep copy
                this.dayData = JSON.parse(JSON.stringify(rawData));
                this.hasData = true;
                this.calculateTotals();
            },

            calc(key, qty) {
                const item = this.db[key];
                if (!item) return { p:0, f:0, c:0, kcal:0 };
                let grams = qty;
                if(this.weights[key] && qty < 10) grams = qty * this.weights[key];
                return {
                    p: (item.p*grams)/100, f: (item.f*grams)/100, c: (item.c*grams)/100, kcal: (item.k*grams)/100
                };
            },

            getMealKcal(ingredients) {
                if(!ingredients) return 0;
                return Math.round(ingredients.reduce((a,c) => a + this.calc(c.k, c.q).kcal, 0));
            },

            calculateTotals() {
                this.totals = { p:0, f:0, c:0, kcal:0 };
                this.mealOrder.forEach(m => {
                    if(this.dayData[m]) {
                        this.dayData[m].forEach(i => {
                            const mac = this.calc(i.k, i.q);
                            this.totals.p += mac.p; this.totals.f += mac.f; this.totals.c += mac.c; this.totals.kcal += mac.kcal;
                        });
                    }
                });
            },

            getUnit(k) {
                if(['leche','cafe'].includes(k)) return 'ml';
                if(this.weights[k]) return 'ud';
                return 'g';
            },

            getMealColor(name) {
                const n = name.toLowerCase();
                if(n.includes('desayuno')) return 'bg-amber-400';
                if(n.includes('media')) return 'bg-orange-300';
                if(n.includes('comida')) return 'bg-emerald-500';
                if(n.includes('merienda')) return 'bg-purple-400';
                if(n.includes('cena')) return 'bg-indigo-500';
                return 'bg-gray-400';
            }
        }
    }
</script>
</body>
</html>
